name: "Update"

on:
  workflow_dispatch:
  schedule:
    - cron: '*/30 * * * *'  # Her 30 dakikada bir (UTC)

jobs:
  updater:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Fetch and group playlist files as real M3U
      run: |
        # Eski dosyayı temizle
        rm -f yalcin.m3u

        # M3U başlık
        echo "#EXTM3U" >> yalcin.m3u
        echo "# Güncelleme tarihi: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> yalcin.m3u
        echo "" >> yalcin.m3u

        # --- Türk Kanalları ---
        echo "#EXTINF:-1 group-title=\"Türk Kanalları\", Kaynak: trgoalas.m3u" >> yalcin.m3u
        curl -s https://raw.githubusercontent.com/karams81/voddensrb/main/trgoalas.m3u | \
          sed 's/^#EXTINF:-1/#EXTINF:-1 group-title="Türk Kanalları"/' >> yalcin.m3u
        echo "" >> yalcin.m3u

        # --- NexaTV ---
        echo "#EXTINF:-1 group-title=\"NexaTV\", Kaynak: NexaTV.m3u" >> yalcin.m3u
        curl -s https://raw.githubusercontent.com/karams81/voddensrb/main/NexaTV.m3u | \
          sed 's/^#EXTINF:-1/#EXTINF:-1 group-title="NexaTV"/' >> yalcin.m3u
        echo "" >> yalcin.m3u

        # --- Selçuk Yayınları ---
        echo "#EXTINF:-1 group-title=\"Selçuk Yayınları\", Kaynak: selcuk.m3u" >> yalcin.m3u
        curl -s https://raw.githubusercontent.com/karams81/voddensrb/main/selcuk.m3u | \
          sed 's/^#EXTINF:-1/#EXTINF:-1 group-title="Selçuk Yayınları"/' >> yalcin.m3u
        echo "" >> yalcin.m3u

        # --- Rus Futbol Kanalları ---
        echo "#EXTINF:-1 group-title=\"Rus Futbol Kanalları\", Kaynak: futbol.m3u" >> yalcin.m3u
        curl -s https://raw.githubusercontent.com/la22lo/sports/refs/heads/main/futbol.m3u | \
          sed 's/^#EXTINF:-1/#EXTINF:-1 group-title="Rus Futbol Kanalları"/' >> yalcin.m3u
        echo "" >> yalcin.m3u

        # --- Boss ---
        echo "#EXTINF:-1 group-title=\"Boss\", Kaynak: bossh.m3u" >> yalcin.m3u
        curl -s https://raw.githubusercontent.com/karams81/srbyout/refs/heads/main/bossh.m3u | \
          sed 's/^#EXTINF:-1/#EXTINF:-1 group-title="Boss"/' >> yalcin.m3u
        echo "" >> yalcin.m3u

    - name: Commit and push changes
      env:
        GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
      run: |
        set -euo pipefail

        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"

        git add yalcin.m3u
        if git diff --cached --quiet; then
          echo "No changes to commit."
          exit 0
        fi

        git commit -m "Auto-update yalcin.m3u"
        git push origin HEAD:${GITHUB_REF}
